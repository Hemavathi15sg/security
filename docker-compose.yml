version: '3.8'

services:
  # Optional: Local environment for running vulnerable app (if needed for demos)
  securetrails-vulnerable:
    build:
      context: ./apps/securetrails-vulnerable
      dockerfile: Dockerfile
    ports:
      - "5000:5000"
    environment:
      - FLASK_ENV=development
      - FLASK_APP=app.py
    volumes:
      - ./apps/securetrails-vulnerable:/app
    command: python app.py
    # WARNING: This app is intentionally vulnerable for learning purposes
    # DO NOT expose to the internet

  # Optional: Security scanning container
  security-scanner:
    image: python:3.11-slim
    working_dir: /workspace
    volumes:
      - ./apps/securetrails-vulnerable:/workspace
      - ./scripts:/scripts
    command: /bin/bash -c "pip install -r requirements.txt -q && python /scripts/scan-all.py"
    depends_on:
      - securetrails-vulnerable

  # Optional: Database for demo purposes
  sqlite-browser:
    image: keinos/sqlite3:latest
    volumes:
      - ./apps/securetrails-vulnerable:/data
    command: sqlite3 /data/database.db .tables
    profiles: ["tools"]
